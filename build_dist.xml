<?xml version="1.0"?>
<project name="JavaCoreTest" default="maintar">

  <property name="project.name" value="JavaCoreTest"/>
  <property name="src.dir" value="src"/>
  <property name="test.dir" value="test"/>
  <property name="lib.dir" value="lib"/>
  <property name="target.dir" value="target"/>
  <property name="classes.dir" value="${target.dir}/classes"/>
  <property name="hexaa.web.dir" value="/usr/share/hexaa/web"/>
  <property name="junit.out.dir"  value="${hexaa.web.dir}/xml/"/>
  <property name="junit.out.dir.html" value="${hexaa.web.dir}/report"/>

  <target name="makedir" description="Recreate required directories">
    <delete dir="${classes.dir}"/>
    <mkdir  dir="${classes.dir}"/>
    <mkdir  dir="${junit.out.dir}"/>
    <mkdir  dir="${junit.out.dir.html}" />
  </target>

  <target name="compile" depends="makedir" description="Compile java code.">
    <javac includeantruntime="false" debug="true" destdir="${classes.dir}">
      <src path="${src.dir}"/>
      <src path="${test.dir}"/>
      <classpath>
        <fileset dir="${lib.dir}" includes="**/*.jar"/>
      </classpath>
    </javac>
  </target>

    <path id="classpath.test">
      <path path="${java.class.path}"/>
      <pathelement location="${classes.dir}"/>
        <fileset dir="${lib.dir}" includes="**/*.jar"/>
      <path location="${classes.dir}"/>
    </path>

  <target name="report" description="creates a report from the test outputs">
    <mkdir dir="${junit.out.dir.html}" />
    <junitreport todir="${junit.out.dir.html}">
      <fileset dir="${junit.out.dir}">
        <include name="TEST*.xml" />
      </fileset>
      <report todir="${junit.out.dir.html}" />
    </junitreport>
  </target>

  <target name="testlevelone" description="runs the first test suite">
    <tstamp>
      <format property="current.time" pattern="MM/dd hh:mm:ss aa" />
    </tstamp>
    <junit printsummary="yes" haltonfailure="no" fork="no" maxmemory="512m">
      <classpath refid="classpath.test"/>
      <sysproperty key="ant.home" value="${ant.home}"/>
      <formatter type="xml"/>
      <formatter type="plain"/>
      <batchtest fork="yes" todir="${junit.out.dir}">
        <fileset dir="${classes.dir}" includes="**/leveledtests/Level1TestSuite.class"/>
      </batchtest>
    </junit>
  </target>

  <target name="testleveltwo" description="Running Level two Test Suite">
    <tstamp>
      <format property="current.time" pattern="MM/dd hh:mm:ss aa" />
    </tstamp>
    <junit printsummary="yes" haltonfailure="no" fork="no" maxmemory="512m">
      <classpath refid="classpath.test"/>
      <sysproperty key="ant.home" value="${ant.home}"/>
      <formatter type="xml"/>
      <formatter type="plain"/>
      <batchtest fork="yes" todir="${junit.out.dir}">
        <fileset dir="${classes.dir}" includes="**/leveledtests/Level2TestSuite.class"/>
      </batchtest>
    </junit>
  </target>

  <target name="testlevelthree" description="Running Level three Test Suite">
    <tstamp>
      <format property="current.time" pattern="MM/dd hh:mm:ss aa" />
    </tstamp>
    <junit printsummary="yes" haltonfailure="no" fork="no" maxmemory="512m">
      <classpath refid="classpath.test"/>
      <sysproperty key="ant.home" value="${ant.home}"/>
      <formatter type="xml"/>
      <formatter type="plain"/>
      <batchtest fork="yes" todir="${junit.out.dir}">
        <fileset dir="${classes.dir}" includes="**/leveledtests/Level3TestSuite.class"/>
      </batchtest>
    </junit>
  </target>

  <target name="testlevelfour" description="Running Level four Test Suite">
    <tstamp>
      <format property="current.time" pattern="MM/dd hh:mm:ss aa" />
    </tstamp>
    <junit printsummary="yes" haltonfailure="no" fork="no" maxmemory="512m">
      <classpath refid="classpath.test"/>
      <sysproperty key="ant.home" value="${ant.home}"/>
      <formatter type="xml"/>
      <formatter type="plain"/>
      <batchtest fork="yes" todir="${junit.out.dir}">
        <fileset dir="${classes.dir}" includes="**/leveledtests/Level4TestSuite.class"/>
      </batchtest>
    </junit>
  </target>

  <target name="testlevelfive" description="Running Level five Test Suite">
    <tstamp>
      <format property="current.time" pattern="MM/dd hh:mm:ss aa" />
    </tstamp>
    <junit printsummary="yes" haltonfailure="no" fork="no" maxmemory="512m">
      <classpath refid="classpath.test"/>
      <sysproperty key="ant.home" value="${ant.home}"/>
      <formatter type="xml"/>
      <formatter type="plain"/>
      <batchtest fork="yes" todir="${junit.out.dir}">
        <fileset dir="${classes.dir}" includes="**/leveledtests/Level5TestSuite.class"/>
      </batchtest>
    </junit>
  </target>

  <target name="maintar" depends="compile" description="">
    <antcall target="testlevelone" />
    <antcall target="report" />
    <antcall target="testleveltwo" />
    <antcall target="report" />
    <antcall target="testlevelthree" />
    <antcall target="report" />
    <antcall target="testlevelfour" />
    <antcall target="report" />
    <antcall target="testlevelfive" />
    <antcall target="report" />
  </target>

</project>
